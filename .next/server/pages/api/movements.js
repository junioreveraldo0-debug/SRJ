"use strict";(()=>{var e={};e.id=227,e.ids=[227],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1721:e=>{e.exports=import("@upstash/redis")},6555:e=>{e.exports=import("uuid")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},1176:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>l,default:()=>d,routeModule:()=>m});var i=a(1802),n=a(7153),s=a(6249),o=a(1158),u=e([o]);o=(u.then?(await u)():u)[0];let d=(0,s.l)(o,"default"),l=(0,s.l)(o,"config"),m=new i.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/movements",pathname:"/api/movements",bundlePath:"",filename:""},userland:o});r()}catch(e){r(e)}})},1158:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>handler});var i=a(3924),n=a(6555),s=e([i,n]);async function handler(e,t){try{if("POST"===e.method){let{roll_id:a,quantity:r,note:s,type:o}=e.body;if(!a||!r)return t.status(400).send("Missing");let u=await (0,i.c)("rolls"),d=u.find(e=>e.id===a);if(!d)return t.status(404).send("Roll not found");let l=(0,n.v4)(),m={id:l,roll_id:a,article_id:d.article_id,articleName:d.articleName,quantity:Number(r),note:s,type:o||"OUT",performed_by:"admin",created_at:new Date().toISOString()};if("OUT"===m.type){let e=Number(d.remaining_quantity)-Number(r);if(e<0)return t.status(400).send("Quantidade maior que restante");d.remaining_quantity=e,await (0,i.P)("rolls",u)}let c=await (0,i.c)("movements");return c.unshift(m),await (0,i.P)("movements",c),t.json(m)}if("GET"===e.method){let e=await (0,i.c)("movements");return t.json(e.slice(0,50))}t.status(405).end()}catch(e){console.error(e),t.status(500).send("Erro")}}[i,n]=s.then?(await s)():s,r()}catch(e){r(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[222,924],()=>__webpack_exec__(1176));module.exports=a})();